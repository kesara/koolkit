# Main Makefile for papercut
# Copyright (C) 2007 Kesara Nanayakkara Rathnayake.

# This file is part of papercut.
 
# papercut is free software: you may redistribute it and/or modify
# it under the terms of the GNU General Public License, as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
 
# papercut is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
 
# You should have received a copy of the GNU General Public License
# along with papercut. If not, see <http://www.gnu.org/licenses/>.

SHELL = /bin/sh
top_srcdir = @top_srcdir@
srcdir = @srcdir@
VPATH = @srcdir@

.SUFFIXES:
.SUFFIXES: .c .o

OPT=-g -O

AR = ar
AR_FLAGS = rc
RANLIB = @RANLIB@

CC = @CC@
CFLAGS = -I. @CFLAGS@
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@
INSTALL = @INSTALL@
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = $(exec_prefix)/bin
libdir = $(prefix)/lib
infodir = $(prefix)/info

SOURCES=src/errors.c src/args.c src/stat.c src/main.c src/papercut.h
OBJS=errors.o args.o stat.o main.o
MISC=configure mkinstalldirs install-sh aclocal.m4
HEADERS=src/papercut.h

all: papercut

install: all
	$(top_srcdir)/mkinstalldirs $(DESTDIR)$(bindir)
	$(INSTALL) papercut $(DESTDIR)$(bindir)/papercut

uninstall:
	/bin/rm -f $(bindir)/papercut

papercut: $(OBJS)
	$(CC) $(CFLAGS) -o papercut $(OBJS) $(LIBS)

errors.o: src/errors.c $(HEADERS)
	$(CC) $(CFLAFS) -c src/errors.c

args.o: src/args.c $(HEADERS)
	$(CC) $(CFLAFS) -c src/args.c

stat.o: src/stat.c $(HEADERS)
	$(CC) $(CFLAFS) -c src/stat.c

main.o: src/main.c $(HEADERS)
	$(CC) $(CFLAFS) -c src/main.c

clean:
	/bin/rm -f core $(OBJS) papercut

distclean: clean
	/bin/rm -f Makefile config.h config.status config.cache config.log \
		marklib.dvi

mostlyclean: clean

maintainer-clean: clean

# automatic re-running of configure if the ocnfigure.in file has changed
${srcdir}/configure: configure.in aclocal.m4
	cd ${srcdir} && autoconf

# autoheader might not change config.h.in, so touch a stamp file
${srcdir}/config.h.in: stamp-h.in
${srcdir}/stamp-h.in: configure.in aclocal.m4
		cd ${srcdir} && autoheader
		echo timestamp > ${srcdir}/stamp-h.in

config.h: stamp-h
stamp-h: config.h.in config.status
	./config.status
Makefile: Makefile.in config.status
	./config.status
config.status: configure
	./config.status --recheck
